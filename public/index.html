<!DOCTYPE html>
<html data-bs-theme="dark">

<head>
  <title>BIM Showcase Hub</title>
  <meta charset="utf-8" />
  <link rel="shortcut icon" href="https://bimshowcase.romangolev.com/favicon.ico" color="#5bbad5">
  <!-- Common packages: jQuery, Bootstrap, jsTree -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.7/jstree.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.7/themes/default-dark/style.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.7/themes/default/style.min.css" />

  <!-- Chart JS -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" ></script>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css" />

  <!-- Notification ballons and clipboard util -->
  <script src="js/libraries/notify.min.js"></script>
  <script src="js/libraries/clipboard.min.js"></script>

  <!-- SheetJS   https://github.com/Autodesk-Forge/bim360appstore-model.derivative-nodejs-xls.exporter   -->
  <!-- <script src="node_modules/xlsx/dist/xlsx.core.min.js"></script> -->
  <!-- <script src="node_modules/jszip/dist/jszip.min.js"></script> -->

  <!-- XLS related libraries -->
  <script src="js/libraries/Blob.js"></script> <!-- https://github.com/eligrey/Blob.js -->
  <script src="js/libraries/FileSaver.min.js"></script> <!-- https://github.com/eligrey/FileSaver.js -->
  <script src="js/libraries/xlsx.core.min.js"></script> <!-- https://github.com/SheetJS/js-xlsx -->
  <script src="js/ForgeXLS.js"></script>

  <!-- Autodesk Forge Viewer files -->
  <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.min.css" type="text/css">
  <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.min.js"></script>
  <!-- this project files -->
  <link href="css/main.css" rel="stylesheet" />
  <script src="js/ForgeTree.js"></script>
  <script src="js/paintbrushes.js"></script>
  <script src="js/modelsummaryextension.js"></script>
  <script src="js/ForgeXLS.js"></script>  
  <script src="js/xlsextension.js"></script>
  <script src="js/dashboardhandler.js"></script>
 
  <script src="js/dashboard/DashBoardPanel.js"></script>
  <script src="js/dashboard/PanelBarChart.js"></script>
  <script src="js/dashboard/PanelPieChart.js"></script>
  <script src="js/dashboard/DashBoard.js"></script>
  <script src="js/ForgeViewer.js"></script>


</head>

<body>
<main>

   <nav class="navbar navbar-expand-lg bg-body-tertiary">
     <div class="container-fluid">
       <a href="#"
          id="toggleSidebar"
          title="Show/collapse project tree"
          data-bs-target="#sidebar"
          data-bs-toggle="collapse"
          class="nav-link px-2" ><i class="bi bi-chevron-left "></i></a>
       <a href="/" class="navbar-brand">BIM Showcase Hub</a>
       <button class="navbar-toggler" 
               type="button"
               data-bs-toggle="collapse" 
               data-bs-target="#navbarSupportedContent" 
               aria-controls="navbarSupportedContent" 
               aria-expanded="false"
               aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
       </button>
       <div class="collapse navbar-collapse" id="navbarSupportedContent">
         <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li><a href="#" 
                 class="nav-link px-2" 
                 data-bs-toggle="collapse" 
                 data-bs-target="#sidebar">
                 <i class="bi bi-list bi-lg py-2 p-1"></i>Hide/Show Tree
               </a>
          </li>
          <li><a href="#" id="colorModeIcon" class="nav-link" onclick="changeColorMode();"><i class="bi bi-sun-fill bi-lg py-2 p-1"></i></a></li>
         </ul>
         <div class="dropdown text-end">
               <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    <img id="userInfoNav" src="https://img.icons8.com/ios/250/user-male-circle--v1.png" alt="mdo" width="32" height="32" class="rounded-circle">
               </a>
               <ul class="dropdown-menu dropdown-menu-lg-end text-small" >
                    <li><span id="navUserName" class="dropdown-item-text">Hello there!</span></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a id="autodeskSigninButtonNav"
                         class="dropdown-item" 
                         href="#">Sign in</a></li>
                    <li><a href="#" class="dropdown-item"  data-bs-toggle="modal" data-bs-target="#provisioningModal">Provisioning</a></li>
                    <li><a href="#"  class="dropdown-item" data-bs-toggle="modal" data-bs-target="#aboutModal">About</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a id="signOutNav"
                         class="dropdown-item disabled"
                         href="#">Sign out</a></li>
               </ul>
          </div>
       </div>
     </div>
   </nav>

  <!-- The Modal Provisioning -->
  <div class="modal fade" id="provisioningModal">
     <div class="modal-dialog">
       <div class="modal-content">
 
         <!-- Modal Provisioning Header -->
         <div class="modal-header">
           <h4 class="modal-title">Provisioning</h4>
           <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
         </div>
 
         <!-- Modal Provisioning body -->
         <div class="modal-body">
           <ul>
             <li>To make this application work you might need a provisioning from your APS account.</li>
             <li>In order to make provisioning follow this steps:</li>
             <li><a href="https://tutorials.autodesk.io/#provision-access-in-other-products" target="_blank">Provisioning manual</a></li>
             <li>And put the following credentials: </li>
             <li>Client ID:</li>
             <fieldset>
               <div class="input-group mb-3">
                    <input id="clientid"
                           readonly="true" 
                           type="text" 
                           class="form-control" 
                           placeholder="Recipient's username" 
                           aria-label="Recipient's username" 
                           aria-describedby="basic-addon2" 
                           value="ai0Zu2vLgT0WB0WmJQ1HFrn1KRbUl4At"
                           >
                    <button class="btn btn-outline-secondary" 
                            type="button" 
                            id="button-copy-clientid" 
                            data-clipboard-target="clientid"
                            onclick="copyToClipboard('clientid')">Copy to clipboard</button>
               </div>
             </fieldset>
             <li>Application Name:</li>
             <fieldset>
               <div class="input-group mb-3">
                    <input id="appname"
                           readonly="true" 
                           type="text" 
                           class="form-control" 
                           placeholder="Recipient's username" 
                           aria-label="Recipient's username" 
                           aria-describedby="basic-addon2" 
                           value="BIM Showcase Hub">
                    <button class="btn btn-outline-secondary" 
                            type="button" 
                            id="button-copy-appname"
                            onclick="copyToClipboard('appname')">Copy to clipboard</button>
               </div>
             </fieldset>
             <iframe id="hiddenFrame" style="visibility: hidden" ></iframe>
           </ul>
           
         </div>
 
         <!-- Modal Provisioning footer -->
         <div class="modal-footer">
           <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
         </div>
 
       </div>
     </div>
   </div>

  <!-- The Modal About -->
  <div class="modal fade" id="aboutModal">
     <div class="modal-dialog">
       <div class="modal-content">
 
         <!-- Modal About Header -->
         <div class="modal-header">
           <h4 class="modal-title">About</h4>
           <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
         </div>
 
         <!-- Modal About body -->
         <div class="modal-body">
           <ul>
             <li>This web application connects to the APS DB and allows to view models using Forge viewer with the functionality of the extensions with which you can:</li>
             <li>1. Open dashboard and see model data in the format of a chart</li>
             <li>2. Download model data in excel format</li>
             <li>3. Paint selected elements</li>
             <li>Send me an <a href="mailto: rv.golev@gmail.com">email</a> for any question</li>
             <li>Check out my portfolio <a href="https://www.romangolev.com">website</a></li>
           </ul>
         </div>
         <!-- Modal About footer -->
         <div class="modal-footer">
           <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
         </div>
 
       </div>
     </div>
   </div>

<div class="container-fluid">
    <div class="row flex-nowrap">
        <div id="sidebarcolumn" class="col-auto px-0">
            <div id="sidebar" class="collapse width collapse-horizontal show border-end">
                <div>
                  <!-- <span id="userInfo"></span> -->
                  <span id="projectTree"
                        class="bi bi-boxes panel-heading" 
                        data-toggle="tooltip" 
                        style="padding: 0px;margin-left:10px;display: none;">  Project Tree</span>
                  <span id="refreshHubs" 
                        class="bi bi-arrow-clockwise" 
                        style="cursor: pointer; display: none;float: right; margin-right:10px" 
                        title="Refresh list of files"> Refresh </span>
                  <!-- <span id="signOut"
                        class="bi bi-box-arrow-right" 
                        style="margin-top:5px;cursor: pointer; float: right; display: none" 
                        title="Sign out"> </span> -->
                </div>
                <div id="userHubs">
                  <div style="padding-top: 100px; text-align: center;">
                    <button class="btn btn-lg btn-outline-light" id="autodeskSigninButton">
                      <img src="https://github.com/Autodesk-Forge/learn.forge.viewhubmodels/raw/master/img/autodesk_text.png"
                        height="20"> Sign in
                    </button>
                    <br/>
                    <br/>
                    <br/> You may also need to provision your<br/> BIM 360 Docs account for this app.<br/>
                    <a href="https://forge.autodesk.com/blog/bim-360-docs-provisioning-forge-apps">Learn more</a>.
                  </div>
                </div>

            </div>
        </div>
        <main id="viewercolumn" class="col ps-md-2 pt-2 border-top-0">
            <div id="forgeViewer">
        </main>
    </div>
</div>
</main>
<script>

function changeChevron(){
     if ($("#toggleSidebar").attr("aria-expanded") === 'false') {
          $('#toggleSidebar').children().removeClass('bi bi-chevron-left');
          $('#toggleSidebar').children().addClass('bi bi-chevron-right');
     } else if ($("#toggleSidebar").attr("aria-expanded") === 'true'){
          $('#toggleSidebar').children().removeClass('bi bi-chevron-right');
          $('#toggleSidebar').children().addClass('bi bi-chevron-left');
     }
}

//Viewer events on sidepanel collapse
$('#sidebar').on('shown.bs.collapse', function () {
     changeChevron();
     if ($('#forgeViewer').children().length > 0) {
               viewer.resize();
     }
})
$('#sidebar').on('hidden.bs.collapse', function () {
     changeChevron();
     if ($('#forgeViewer').children().length > 0) {
               viewer.resize();
     }
})

async function dashexpand(){
     let classname = $('#dashboard').attr("class")
     let re = /col-sm-./;
     let col = classname.match(re)[0]
     let n = col[col.length-1]
     if (n < 8){
          $('#dashboard').removeClass('col-sm-'+n);
          $('#dashboard').addClass('col-sm-'+ (parseInt(n)+1));
          if ($('#forgeViewer').children().length > 0) {
               viewer.resize();
          }
     } else if (n == 8){
          $('#dashboard').removeClass('col-sm-'+n);
          $('#dashboard').addClass('col-sm-'+ (parseInt(n)+1));
          if ($('#forgeViewer').children().length > 0) {
               viewer.resize();
          }
     }
}
async function dashcollapse(){
     let classname = $('#dashboard').attr("class")
     let re = /col-sm-./;
     let col = classname.match(re)[0]
     let n = col[col.length-1]
     if (n > 3){
          $('#dashboard').removeClass('col-sm-'+n);
          $('#dashboard').addClass('col-sm-'+ (parseInt(n)-1));
          if ($('#forgeViewer').children().length > 0) {
               viewer.resize();
          }
          
     } else if (n == 8){
          $('#dashboard').removeClass('col-sm-'+n);
          $('#dashboard').addClass('col-sm-'+ (parseInt(n)-1));
          if ($('#forgeViewer').children().length > 0) {
               viewer.resize();
          }    
     }
}

function changeColorMode(){
     if (document.documentElement.getAttribute('data-bs-theme') == 'dark') {
          document.documentElement.setAttribute('data-bs-theme','light');
          $('#colorModeIcon').children().removeClass('bi-sun-fill');
          $('#colorModeIcon').children().addClass('bi-moon-stars-fill');
          $("#userHubs").jstree("set_theme","default");
          $("#autodeskSigninButton").removeClass('btn-outline-light');
          $("#autodeskSigninButton").addClass('btn-outline-dark');
     }
     else {
          document.documentElement.setAttribute('data-bs-theme','dark');
          $('#colorModeIcon').children().removeClass('bi-moon-stars-fill');
          $('#colorModeIcon').children().addClass('bi-sun-fill');
          $("#userHubs").jstree("set_theme","default-dark");
          $("#autodeskSigninButton").removeClass('btn-outline-dark');
          $("#autodeskSigninButton").addClass('btn-outline-light');


     }
}
// copy to clipboard function
function copyToClipboard(destId) {
  var copyText = document.getElementById(destId);
  copyText.select();
  navigator.clipboard.writeText(copyText.value);
}

</script>
</body>
</html>
